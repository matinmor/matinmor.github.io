<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS RAG LLaVA LLAMA Evaluation</title>
    <style>
        .question-container {
            margin-bottom: 20px;
        }
        .statement-container {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div id="questionnaire"></div>

    <button id="nextButton" onclick="nextQuestion()">Next</button>
    <button id="saveButton" onclick="saveResponses()">Save</button>

    <script>
        let data = [];
        let currentQuestionIndex = 0;
        const responses = [];

        async function fetchData() {
            const response = await fetch('CS_RAG_LLaVALLAMA2.json');
            data = await response.json();
            loadQuestion();
        }

        function loadQuestion() {
            const questionnaireDiv = document.getElementById('questionnaire');
            questionnaireDiv.innerHTML = '';
            if (currentQuestionIndex >= data.length) {
                saveResponses();
                return;
            }

            const questionData = data[currentQuestionIndex];
            const questionContainer = document.createElement('div');
            questionContainer.className = 'question-container';

            const question = document.createElement('h2');
            question.textContent = questionData.Question;
            questionContainer.appendChild(question);

            questionData.img_dir.forEach(imageSrc => {
                const img = document.createElement('img');
                img.src = imageSrc;
                img.alt = "Question Image";
                img.style.maxWidth = "200px";
                img.style.margin = "10px";
                questionContainer.appendChild(img);
            });

            questionData.out.forEach((statement, index) => {
                const statementContainer = document.createElement('div');
                statementContainer.className = 'statement-container';
                statementContainer.innerHTML = `
                    <p>${statement}</p>
                    <input type="radio" name="statement${index}" value="correct"> Correct
                    <input type="radio" name="statement${index}" value="incorrect"> Incorrect
                    <input type="radio" name="statement${index}" value="subjective"> Subjective
                `;
                questionContainer.appendChild(statementContainer);
            });

            questionnaireDiv.appendChild(questionContainer);
        }

        function nextQuestion() {
            const questionData = data[currentQuestionIndex];
            const questionResponses = { Question: questionData.Question, Responses: [] };
            
            questionData.out.forEach((statement, index) => {
                const radios = document.getElementsByName(`statement${index}`);
                let selectedValue = '';
                for (const radio of radios) {
                    if (radio.checked) {
                        selectedValue = radio.value;
                        break;
                    }
                }
                questionResponses.Responses.push({ statement, response: selectedValue });
            });

            responses.push(questionResponses);

            currentQuestionIndex++;
            loadQuestion();
        }

        function saveResponses() {
            const blob = new Blob([JSON.stringify(responses)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'responses.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initial load
        fetchData();
    </script>

</body>
</html>
